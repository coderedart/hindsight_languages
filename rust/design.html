<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Design - Hindsight Language Development</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../rust.html"><strong aria-hidden="true">1.</strong> Rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/syntax.html"><strong aria-hidden="true">1.1.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="../rust/types.html"><strong aria-hidden="true">1.2.</strong> Types</a></li><li class="chapter-item expanded "><a href="../rust/design.html" class="active"><strong aria-hidden="true">1.3.</strong> Design</a></li><li class="chapter-item expanded "><a href="../rust/tooling.html"><strong aria-hidden="true">1.4.</strong> Tooling</a></li></ol></li><li class="chapter-item expanded "><a href="../cpp.html"><strong aria-hidden="true">2.</strong> C++</a></li><li class="chapter-item expanded "><a href="../c.html"><strong aria-hidden="true">3.</strong> C</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Hindsight Language Development</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3 id="async"><a class="header" href="#async">Async</a></h3>
<p>Your function cannot be generic over async code.</p>
<h4 id="coloring"><a class="header" href="#coloring">Coloring</a></h4>
<p>Either it is async or it is not. so, when you add a little bit of async, it starts infecting the rest of the codebase spreading async keyword everywhere.</p>
<ol>
<li>Every function has a color. 
yep. <code>async fn</code> vs <code>fn</code> -&gt; returns future or not. </li>
<li>The way you call a function depends on its color.
yes. .await syntax. </li>
<li>You can only call a red function from within another red function. 
nope. technically, you can block_on a future inside a sync fn. </li>
<li>Red functions are more painful to call.
yep. well, it has more to do with the synchronization / borrowing issues rather than just calling them with some_fn().await. </li>
<li>Some core library functions are red.
yes, but not yet because rust doesn't really have async fns in std yet. instead we need to use external crates like async-std / tokio for which this is true. 
unless we get keyword generics<sup class="footnote-reference"><a href="#keyword_generics">1</a></sup> , we will have a async version of a lot of std apis like fs, sync (mutexes, channels ), net and so on. </li>
</ol>
<h4 id="runtime"><a class="header" href="#runtime">Runtime</a></h4>
<p>Unlike garbage collected languages like Go or .Net family or Javascript, Rust has to work <em>without</em> a runtime. 
This is made worse because Rust doesn't actually provide a runtime in std library either. So, we have to go find external crates to find a suitable runtime. This can be considered a good thing and a bad thing. On one hand, we can explicitly choose the most suitable runtime for your workload, but OTOH It is a long-lasting choice for your project. The runtime might be abandoned or your organization might not allow dependencies which are not backed by an organization. </p>
<h3 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h3>
<p>Rust has two different ways of dealing with errors. </p>
<ol>
<li>Panic machinery
This is kinda like exceptions. It starts throwing the exception up the call chain until someone catches it or program crashes.
Has stack unwinding to provide a backtrace.
The primary advantage is that a function doesn't have to encode in the fn signature that it can panic. 
Similar to an allocator, this is a global thing. so, we can register a custom panic handler to log errors and so on before unwinding stack.</li>
<li>Result Type
This is a generic enum <code>Result&lt;T, E&gt;</code> with an <code>Ok(T)</code> variant and an <code>Err(E)</code> variant. This allows you to encode the return type clearly. 
Any function that wants the resulting <code>T</code> of this <code>Result</code> MUST deal with the error case explicitly (at the very least, simply by <code>unwrap</code>ing to panic).
Allows explicit <code>Error</code> types which you can recover from by simply handling the error and using a default T or calling the previous fn again etc..</li>
</ol>
<p>From the reddit post<sup class="footnote-reference"><a href="#cpp_rust_exception_error">2</a></sup> :</p>
<h4 id="exception-agnosticism-is-easy-but-error-agnosticism-is-not"><a class="header" href="#exception-agnosticism-is-easy-but-error-agnosticism-is-not">Exception-Agnosticism is Easy, but Error-Agnosticism is Not</a></h4>
<p>Exception vs Error can be considered as <code>panic</code> vs <code>result</code>.
We cannot bubble up an <code>Result</code> automatically when we don't care about it. we have to encode it in the fn signature.
so, if an infallible function becomes fallible, it will be a breaking change. 
Whereas, with panicking, we don't have to worry about this. let the caller handle the panic, we can just work with the code under the assumption that there will be no errors. </p>
<h4 id="boiler-plate"><a class="header" href="#boiler-plate">Boiler plate</a></h4>
<p>You will have to use match statements when dealing with error variants. Leads to lots of noise sometimes. and this noise is almost at every callsite even thought most of them repeat the same match code. </p>
<pre><code class="language-rust ignore">match fallible_fn() {
    Ok(_) =&gt; {}
    Err(e) =&gt; {
        // do something with e. often, e is an enum itself
        match e {
            ErrorA =&gt; {}
            // ...
            ErrorX =&gt; {}
        }
    }
}
</code></pre>
<h3 id="std-library-versioning"><a class="header" href="#std-library-versioning">std library versioning</a></h3>
<p>This is not a rust specific issue. 
Rust can break backwards comaptibility in core language using editions. but, because two crates interacting with each other use the same std library, 
Rust cannot break backwards compatibility in std library forever<sup class="footnote-reference"><a href="#std_back_compat">3</a></sup>. </p>
<div class="footnote-definition" id="keyword_generics"><sup class="footnote-definition-label">1</sup>
<p>https://blog.rust-lang.org/inside-rust/2022/07/27/keyword-generics.html
<sup class="footnote-reference"><a href="#cpp_rust_exception_error">2</a></sup>: https://www.reddit.com/r/rust/comments/xj2a23/my_thoughts_on_rust_and_c/
<sup class="footnote-reference"><a href="#std_back_compat">3</a></sup>: https://news.ycombinator.com/item?id=22558259</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../rust/types.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../rust/tooling.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../rust/types.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../rust/tooling.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
